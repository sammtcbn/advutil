#!/bin/bash
# https://github.com/sammtcbn/advutil
# just for south-bound
# Written by sammtcbn 2019.4.25
function usage()
{
    echo "Usage: $0 [SERVER_IP]"
    echo "    SERVER_IP: assign MQTT Broker ip, default is localhost,"
    echo "               or you can use a test broker test.mosquitto.org"
    exit 0
}

SERVER=localhost
#TOPIC="/cagent/admin/ODBC_Handler/agentcallbackreq"
TOPIC="/cagent/admin/OPCUAClient/agentcallbackreq"

if [ ! -z "${1}" ]; then
    SERVER=${1}
fi

PAYLOAD="$(cat <<-EOF
{
  "susiCommData": {
    "commCmd": 2056,
    "requestItems": {
      "All": {}
    },
    "handlerName": "general"
  }
}

EOF
)"


mosquitto_pub -h ${SERVER} -t ${TOPIC} -d -m "${PAYLOAD}"
if [ $? != 0 ]; then
    usage
fi
